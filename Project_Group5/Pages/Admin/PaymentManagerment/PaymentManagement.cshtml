@page "/Admin/PaymentManagement"
@model Project_Group5.Pages.Admin.PaymentManagement.PaymentManagementModel
@{
    ViewData["Title"] = "Quản lý Thanh Toán";
    var successMessage = TempData["SuccessMessage"] as string;
}
@if (!string.IsNullOrEmpty(successMessage))
{
    <div class="fixed top-0 left-1/2 transform -translate-x-1/2 z-50 mt-4 w-96 bg-green-500 text-white text-center py-3 px-6 rounded-lg shadow-lg transition-all duration-500"
         id="successMessage">
        <span>@successMessage</span>
    </div>
}


<h2 class="text-3xl font-semibold text-center my-8">Quản lý Thanh Toán</h2>

<!-- Bảng Thanh Toán -->
<div class="overflow-x-auto shadow-md rounded-lg mx-4">
    <table class="min-w-full table-auto bg-white border-separate border-spacing-0">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 border border-gray-300">ID</th>
                <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 border border-gray-300">Ngày Thanh Toán</th>
                <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 border border-gray-300">Số Tiền</th>
                <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 border border-gray-300">Phương Thức Thanh Toán</th>
                <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 border border-gray-300">Trạng Thái</th>
                <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 border border-gray-300">Hành Động</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            @foreach (var payment in Model.Payments)
            {
                <tr class="border-b border-gray-200">
                    <td class="px-6 py-4 text-sm text-gray-900 border border-gray-300">@payment.Id</td>
                    <td class="px-6 py-4 text-sm text-gray-900 border border-gray-300">@payment.PaymentDate.ToString("yyyy-MM-dd")</td>
                    <td class="px-6 py-4 text-sm text-gray-900 border border-gray-300">@payment.Amount</td>
                    <td class="px-6 py-4 text-sm text-gray-900 border border-gray-300">@payment.PaymentMethod</td>
                    <td class="px-6 py-4 text-sm border border-gray-300">
                        @if (payment.Status == "Cancel")
                        {
                            <span class="text-red-500 font-semibold">@payment.Status</span>
                        }
                        else if (payment.Status == "Success")
                        {
                            <span class="text-green-500 font-semibold">@payment.Status</span>
                        }
                        else if (payment.Status == "Pending")
                        {
                            <span class="text-yellow-500 font-semibold">@payment.Status</span>
                        }
                        else
                        {
                            @payment.Status
                        }
                    </td>
                    <td class="px-6 py-4 border border-gray-300">
                        <button type="button" class="btn btn-warning bg-yellow-500 text-white py-2 px-4 rounded-md hover:bg-yellow-400 focus:outline-none"
                                data-toggle="modal" data-target="#editPaymentModal"
                                data-id="@payment.Id"
                                data-bookingid="@payment.BookingId"
                                data-paymentdate="@payment.PaymentDate.ToString("yyyy-MM-dd")"
                                data-amount="@payment.Amount"
                                data-paymentmethod="@payment.PaymentMethod"
                                data-status="@payment.Status">
                            Sửa
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Phân trang -->
<div class="flex justify-center mt-8">
    <nav>
        <ul class="flex items-center space-x-2">
            @if (Model.CurrentPage > 1)
            {
                <li>
                    <a href="@Url.Page("/Admin/PaymentManagement", new { pageIndex = 1 })"
                       class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-l-lg transition duration-200 ease-in-out">
                        Đầu
                    </a>
                </li>
                <li>
                    <a href="@Url.Page("/Admin/PaymentManagement", new { pageIndex = Model.CurrentPage - 1 })"
                       class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 transition duration-200 ease-in-out">
                        «
                    </a>
                </li>
            }

            <li>
                <span class="px-4 py-2 text-sm font-medium text-gray-700">
                    Trang @Model.CurrentPage / @Model.TotalPages
                </span>
            </li>

            @if (Model.CurrentPage < Model.TotalPages)
            {
                <li>
                    <a href="@Url.Page("/Admin/PaymentManagement", new { pageIndex = Model.CurrentPage + 1 })"
                       class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 transition duration-200 ease-in-out">
                        »
                    </a>
                </li>
                <li>
                    <a href="@Url.Page("/Admin/PaymentManagement", new { pageIndex = Model.TotalPages })"
                       class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-r-lg transition duration-200 ease-in-out">
                        Cuối
                    </a>
                </li>
            }
        </ul>
    </nav>
</div>



<!-- Modal Sửa Thanh Toán -->
<div class="modal fade" id="editPaymentModal" tabindex="-1" role="dialog" aria-labelledby="editPaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content rounded-lg shadow-lg bg-white">
            <form method="post" asp-page-handler="Edit" onsubmit="return confirmSubmit()">
                <div class="modal-header bg-blue-600 text-white rounded-t-lg px-6 py-4">
                    <h5 class="modal-title" id="editPaymentModalLabel">Sửa Thanh Toán</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body px-6 py-4 space-y-4">
                    <input type="hidden" asp-for="Payment.Id" />

                    <!-- Trường ID Đặt Chỗ -->
                    <div>
                        <label asp-for="Payment.BookingId" class="block text-sm font-medium text-gray-700">ID Đặt Chỗ</label>
                        <input asp-for="Payment.BookingId" class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" readonly />
                        <span asp-validation-for="Payment.BookingId" class="text-red-500 text-sm"></span>
                    </div>

                    <!-- Trường Số Tiền -->
                    <div>
                        <label asp-for="Payment.Amount" class="block text-sm font-medium text-gray-700">Số Tiền</label>
                        <input asp-for="Payment.Amount" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                        <span asp-validation-for="Payment.Amount" class="text-red-500 text-sm"></span>
                    </div>

                    <!-- Trường Phương Thức Thanh Toán -->
                    <div>
                        <label asp-for="Payment.PaymentMethod" class="block text-sm font-medium text-gray-700">Phương Thức Thanh Toán</label>
                        <select asp-for="Payment.PaymentMethod" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="PayPal">PayPal</option>
                            <option value="Thanh toán tiền mặt">Thanh toán tiền mặt</option>
                        </select>
                        <span asp-validation-for="Payment.PaymentMethod" class="text-red-500 text-sm"></span>
                    </div>

                    <!-- Trường Trạng Thái -->
                    <div>
                        <label asp-for="Payment.Status" class="block text-sm font-medium text-gray-700">Trạng Thái</label>
                        <select asp-for="Payment.Status" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="Pending">Đang chờ</option>
                            <option value="Cancel">Hủy</option>
                            <option value="Success">Thành công</option>
                        </select>
                        <span asp-validation-for="Payment.Status" class="text-red-500 text-sm"></span>
                    </div>
                </div>
                <div class="modal-footer bg-gray-100 rounded-b-lg">
                    <button type="button" class="btn btn-secondary bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-400" data-dismiss="modal">Đóng</button>
                    <button type="submit" class="btn btn-primary bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-400 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .modal-dialog {
        max-width: 600px;
    }

    .modal-content {
        transition: transform 0.3s ease-out;
    }

    .modal.fade .modal-dialog {
        transform: translate(0, -50px);
        opacity: 0;
    }

    .modal.fade.show .modal-dialog {
        transform: translate(0, 0);
        opacity: 1;
    }
</style>


@section Scripts {
    <script>
        function confirmSubmit() {
            return confirm("Bạn có chắc chắn muốn cập nhật thanh toán này?");
        }
        $('#editPaymentModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var bookingId = button.data('bookingid');
            var paymentDate = button.data('paymentdate');
            var amount = button.data('amount');
            var paymentMethod = button.data('paymentmethod');
            var status = button.data('status');

            var modal = $(this);
            modal.find('input[name="Payment.Id"]').val(id);
            modal.find('input[name="Payment.BookingId"]').val(bookingId);  // ID Đặt Chỗ
            modal.find('input[name="Payment.PaymentDate"]').val(paymentDate); // Ngày Thanh Toán (Chỉ Đọc)
            modal.find('input[name="Payment.Amount"]').val(amount);

            // Chọn Phương Thức Thanh Toán
            modal.find('select[name="Payment.PaymentMethod"]').val(paymentMethod);

            // Chọn Trạng Thái
            modal.find('select[name="Payment.Status"]').val(status);
        });

        // Hiển thị thông báo rồi tự động ẩn sau 3 giây
        if (document.getElementById('successMessage')) {
            setTimeout(function () {
                document.getElementById('successMessage').classList.add('opacity-0');
                setTimeout(function () {
                    document.getElementById('successMessage').style.display = 'none';
                }, 500); // Thời gian để fade-out
            }, 3000); // Hiển thị thông báo trong 3 giây
        }
    </script>
}
